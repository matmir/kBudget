<?php

$title = 'kBudget - Analiza czasowa transakcji';
$this->headTitle($title);

$this->headScript()->prependFile($this->basePath('/js/analysis/sort.js'));

?>
<h1><?php echo $this->escapeHtml($title); ?></h1>

<div class="span-24">
<p>
    <a href="<?php echo $this->url('analysis');?>">Powrót</a>
</p>
</div>

<!-- Filtracja -->
<div class="span-24">
    <div class="FilterBox">
        
        <p>Filtracja:</p>
        
        <?php
        
        $form = $this->form;
        $form->setAttribute('action', $this->url('analysis/time'));
        $form->prepare();
        
        echo $this->form()->openTag($form);
        ?>
        
        <table class="TableClear">
        <tr>
            <td><?php echo $form->get('filter_type')->getLabel(); ?></td>
            <td><?php echo $this->formElement($form->get('filter_type')) ?></td>
        </tr>
        <?php
            echo $this->formElementErrors()
                ->setMessageOpenFormat('<tr><td colspan="2">')
                ->setMessageSeparatorString('</td></tr><tr><td colspan="2">')
                ->setMessageCloseString('</tr>')
                ->render($form->get('filter_type'));
        ?>
        <tr class="month_filter">
            <td><?php echo $form->get('month')->getLabel(); ?></td>
            <td><?php echo $this->formElement($form->get('month')) ?></td>
        </tr>
        <?php
            echo $this->formElementErrors()
                ->setMessageOpenFormat('<tr class="month_filter"><td colspan="2">')
                ->setMessageSeparatorString('</td></tr><tr class="month_filter"><td colspan="2">')
                ->setMessageCloseString('</tr>')
                ->render($form->get('month'));
        ?>
        <tr class="month_filter">
            <td><?php echo $form->get('year')->getLabel(); ?></td>
            <td><?php echo $this->formElement($form->get('year')) ?></td>
        </tr>
        <?php
            echo $this->formElementErrors()
                ->setMessageOpenFormat('<tr class="month_filter"><td colspan="2">')
                ->setMessageSeparatorString('</td></tr><tr class="month_filter"><td colspan="2">')
                ->setMessageCloseString('</tr>')
                ->render($form->get('year'));
        ?>
        <tr class="between_filter">
            <td><?php echo $form->get('date_from')->getLabel(); ?></td>
            <td><?php echo $this->formElement($form->get('date_from')) ?></td>
        </tr>
        <?php
            echo $this->formElementErrors()
                ->setMessageOpenFormat('<tr class="between_filter"><td colspan="2">')
                ->setMessageSeparatorString('</td></tr><tr class="between_filter"><td colspan="2">')
                ->setMessageCloseString('</tr>')
                ->render($form->get('date_from'));
        ?>
        <tr class="between_filter">
            <td><?php echo $form->get('date_to')->getLabel(); ?></td>
            <td><?php echo $this->formElement($form->get('date_to')) ?></td>
        </tr>
        <?php
            echo $this->formElementErrors()
                ->setMessageOpenFormat('<tr class="between_filter"><td colspan="2">')
                ->setMessageSeparatorString('</td></tr><tr class="between_filter"><td colspan="2">')
                ->setMessageCloseString('</tr>')
                ->render($form->get('date_to'));
        ?>
        <tr>
            <td colspan="2"><?php echo $this->formSubmit($form->get('submit')); ?></td>
        </tr>
    </table>
    
    <?php echo $this->form()->closeTag(); ?>

    </div>
</div>

<div class="span-24">&nbsp;</div>

<div class="span-24">
    <p>
        <a href="<?php echo $this->url('analysis/time');?>">Wyświetl aktualny miesiąc</a>
    </p>
</div>

<!-- Wykresy (lewa strona) -->
<div class="span-16">
    
    <img src="<?php echo $balance_chart; ?>" alt="Bilans" title="Bilans" />
    
    <p>
        <?php if ($ONE_PROFIT): ?>
        <?php for ($i=0; $i<$ONE_PROFIT; $i++): ?>
            Przychody z dnia <?php echo $this->escapeHtml($dt_profit['labels'][$i]); ?>
            o wartości: <?php echo $this->escapeHtml($dt_profit['data'][$i]); ?>zł
            <br />
        <?php endfor; ?>
        <?php else: ?>
        
            <?php if ($time_profit_chart): ?>
            <img src="<?php echo $time_profit_chart; ?>" alt="Wykres czasowy przychodów" title="Wykres czasowy przychodów" />
            <?php else: ?>
            Brak przychodów w wybranym miesiącu!
            <?php endif; ?>
            
        <?php endif; ?>
    </p>
    
    <p>
        <?php if ($ONE_EXPENSE): ?>
        <?php for ($i=0; $i<$ONE_EXPENSE; $i++): ?>
            Wydatki z dnia <?php echo $this->escapeHtml($dt_expense['labels'][$i]); ?>
            o wartości: <?php echo $this->escapeHtml($dt_expense['data'][$i]); ?>zł
            <br />
        <?php endfor; ?>
        <?php else: ?>
        
            <?php if ($time_expense_chart): ?>
            <img src="<?php echo $time_expense_chart; ?>" alt="Wykres czasowy wydatków" title="Wykres czasowy wydatków" />
            <?php else: ?>
            Brak wydatków w wybranym miesiącu!
            <?php endif; ?>
            
        <?php endif; ?>
    </p>
    
</div>

<!-- Bilans (prawa strona) -->
<div class="span-6 last">

    <div class="transactions-box">
    
        <table>
            <tr>
                <td colspan="2" style="text-align: center;"><b>Bilans</b></td>
            </tr>
            <tr>
                <td><div class="profit">Przychód</div></td>
                <td>+<?php echo $sum_profit; ?>zł</td>
            </tr>
            <tr>
                <td><div class="expense">Wydatki</div></td>
                <td>-<?php echo $sum_expense; ?>zł</td>
            </tr>
            <tr>
                <td><b>Oszczędności</b></td>
                <td><?php echo $balance; ?>zł</td>
            </tr>
        </table>
        
    </div>
    
</div>
